(function(d){function c(l){return l instanceof d||(d.zepto&&d.zepto.isZ(l))}function k(l,m){if(typeof l==="string"&&l.indexOf("-inline-")===0){this.method=m||"html";this.target=this.el=d(l.replace("-inline-","")||"<div/>");return true}}function b(m){if(typeof m==="string"&&m.indexOf("-")!==0){this.method="val";var l=document.createElement("input");l.name=m;l.type="hidden";this.target=this.el=d(l);return true}}function e(l){if(typeof l==="function"){this.target=false;this.method=l;return true}}function g(l,m){if(c(l)&&!m){if(l.is("input, select, textarea")){this.method="val";this.target=l.on("change.liblink",this.changeHandler)}else{this.target=l;this.method="html"}return true}}function i(l,m){if(c(l)&&(typeof m==="function"||(typeof m==="string"&&l[m]))){this.method=m;this.target=l;return true}}var f=[k,b,e,g,i];function a(o,p,n){var m=this,l=false;this.changeHandler=function(r){var q=m.formatInstance.from(d(this).val());if(q===false||isNaN(q)){d(this).val(m.lastSetValue);return false}m.changeHandlerMethod.call("",r,q)};this.el=false;this.formatInstance=n;d.each(f,function(q,r){l=r.call(m,o,p);return !l});if(!l){throw new RangeError("(Link) Invalid Link.")}}a.prototype.set=function(n){var m=Array.prototype.slice.call(arguments),l=m.slice(1);this.lastSetValue=this.formatInstance.to(n);l.unshift(this.lastSetValue);(typeof this.method==="function"?this.method:this.target[this.method]).apply(this.target,l)};function j(l){this.items=[];this.elements=[];this.origin=l}j.prototype.push=function(m,l){this.items.push(m);if(l){this.elements.push(l)}};j.prototype.reconfirm=function(l){var m;for(m=0;m<this.elements.length;m+=1){this.origin.LinkConfirm(l,this.elements[m])}};j.prototype.remove=function(l){var m;for(m=0;m<this.items.length;m+=1){this.items[m].target.off(".liblink")}for(m=0;m<this.elements.length;m+=1){this.elements[m].remove()}};j.prototype.change=function(n){if(this.origin.LinkIsEmitting){return false}this.origin.LinkIsEmitting=true;var l=Array.prototype.slice.call(arguments,1),m;l.unshift(n);for(m=0;m<this.items.length;m+=1){this.items[m].set.apply(this.items[m],l)}this.origin.LinkIsEmitting=false};function h(l,o,p,n){if(l===0){l=this.LinkDefaultFlag}if(!this.linkAPI){this.linkAPI={}}if(!this.linkAPI[l]){this.linkAPI[l]=new j(this)}var m=new a(o,p,n||this.LinkDefaultFormatter);if(!m.target){m.target=d(this)}m.changeHandlerMethod=this.LinkConfirm(l,m.el);this.linkAPI[l].push(m,m.el);this.LinkUpdate(l)}d.fn.Link=function(l){var m=this;if(l===false){return m.each(function(){if(!this.linkAPI){return}d.map(this.linkAPI,function(n){n.remove()});delete this.linkAPI})}if(l===undefined){l=0}else{if(typeof l!=="string"){throw new Error("Flag must be string.")}}return{to:function(o,n,p){return m.each(function(){h.call(this,l,o,n,p)})}}}}(window.jQuery||window.Zepto));